cbuild-run:
  generated-by: csolution version 2.9.0
  solution: SFUD.csolution.yml
  target-type: ARMCLANG
  compiler: AC6
  device: Nuvoton::M55M1H2LJAE
  device-pack: Nuvoton::NuMicroM55_DFP@3.1.4-rc.3
  output:
    - file: out/SFUD/ARMCLANG/Release/SFUD.axf
      info: generate by SFUD.Release+ARMCLANG
      type: elf
      load: image+symbols
    - file: out/SFUD/ARMCLANG/Release/SFUD.bin
      info: generate by SFUD.Release+ARMCLANG
      type: bin
      load: none
  system-resources:
    memory:
      - name: IROM1
        access: rx
        start: 0x00100000
        size: 0x00200000
        from-pack: Nuvoton::NuMicroM55_DFP@3.1.4-rc.3
      - name: IROM2
        access: rx
        start: 0x10100000
        size: 0x00200000
        from-pack: Nuvoton::NuMicroM55_DFP@3.1.4-rc.3
      - name: IROM3
        access: rx
        start: 0x0F100000
        size: 0x00002000
        from-pack: Nuvoton::NuMicroM55_DFP@3.1.4-rc.3
      - name: IRAM1
        access: rwx
        start: 0x20100000
        size: 0x00150000
        from-pack: Nuvoton::NuMicroM55_DFP@3.1.4-rc.3
      - name: IRAM2
        access: rwx
        start: 0x30100000
        size: 0x00150000
        from-pack: Nuvoton::NuMicroM55_DFP@3.1.4-rc.3
  system-descriptions:
    - file: ${CMSIS_PACK_ROOT}/Nuvoton/NuMicroM55_DFP/3.1.4-rc.3/SVD/Nuvoton/M55M1.svd
      type: svd
  debugger:
    name: CMSIS-DAP@pyOCD
    protocol: swd
    clock: 10000000
    gdbserver:
      - port: 3333
  debug-sequences:
    - name: DebugPortStart
      blocks:
        - execute: |
            __var nReset = 0x80;
            DAP_SWJ_Pins(0, nReset, 0);
            DAP_Delay(8000);
            DAP_SWJ_Pins(nReset, nReset, 0);
            DAP_Delay(72800);

            __var SW_DP_ABORT    = 0x0;
            __var DP_CTRL_STAT   = 0x4;
            __var DP_SELECT      = 0x8;
            __var DP_STICKY_BITS = 0x000000B2;          // DP CTRL/STAT: STICKYORUN | STICKYCMP | STICKYERR | WDATAERR
            __var JTAG_DP_STICKY_BITS_CLR = 0x00000032; // DP CTRL/STAT: STICKYORUN | STICKYCMP | STICKYERR
            __var SWD_DP_STICKY_BITS_CLR  = 0x0000001E; // DP ABORT: ORUNERRCLR | WDERRCLR | STKERRCLR | STKCMPCLR
            __var powered_down   = 0;
            __var ctrl_stat_val  = 0;

            // Switch to DP Register Bank 0
            WriteDP(DP_SELECT, 0x00000000);

            // Read DP CTRL/STAT Register and check if CSYSPWRUPACK and CDBGPWRUPACK bits are set
            ctrl_stat_val = ReadDP(DP_CTRL_STAT);
            powered_down = ((ctrl_stat_val & 0xA0000000) != 0xA0000000);
        - if: ctrl_stat_val & DP_STICKY_BITS
          blocks:
            - if: (__protocol & 0xFFFF) == 1
              execute: |
                // Clear JTAG-DP sticky error bits by writing '1', preserve other values
                WriteDP(DP_CTRL_STAT, ctrl_stat_val | JTAG_DP_STICKY_BITS_CLR);
            - if: (__protocol & 0xFFFF) == 2
              execute: |
                // Clear SWD-DP sticky error bits by writing to DP ABORT
                WriteDP(SW_DP_ABORT, SWD_DP_STICKY_BITS_CLR);
        - if: powered_down
          blocks:
            - execute: |
                // Request Debug/System Power-Up
                WriteDP(DP_CTRL_STAT, 0x50000000);
            - while: (ReadDP(DP_CTRL_STAT) & 0xA0000000) != 0xA0000000
              timeout: 1000000
            - if: (__protocol & 0xFFFF) == 1
              execute: |
                // Init AP Transfer Mode, Transaction Counter, and Lane Mask (Normal Transfer Mode, Include all Byte Lanes)
                // Additionally clear STICKYORUN, STICKYCMP, and STICKYERR bits by writing '1'
                WriteDP(DP_CTRL_STAT, 0x50000F00 | JTAG_DP_STICKY_BITS_CLR);
            - if: (__protocol & 0xFFFF) == 2
              execute: |
                // Init AP Transfer Mode, Transaction Counter, and Lane Mask (Normal Transfer Mode, Include all Byte Lanes)
                WriteDP(DP_CTRL_STAT, 0x50000F00);
                // Clear WDATAERR, STICKYORUN, STICKYCMP, and STICKYERR bits of CTRL/STAT Register by write to ABORT register
                WriteDP(SW_DP_ABORT, SWD_DP_STICKY_BITS_CLR);
    - name: DebugPortStop
      blocks:
        - execute: |
            __var DP_ABORT = 0x0;
            __var DP_CTRL_STAT = 0x4;
            __var DP_SELECT    = 0x8;
            __var DHCSR_Addr = 0xE000EDF0;

            WriteDP(DP_ABORT, 0x1F);
            // disable Core Debug via DHCSR
            Write32(DHCSR_Addr, 0xA05F0000);

            // Switch to DP Register Bank 0
            WriteDP(DP_SELECT, 0x00000000);

            // Power Down Debug port
            WriteDP(DP_CTRL_STAT, 0x00000000);
  programming:
    - algorithm: ${CMSIS_PACK_ROOT}/Nuvoton/NuMicroM55_DFP/3.1.4-rc.3/Flash/M55M1_AP_2M.FLM
      start: 0x00100000
      size: 0x00200000
      ram-start: 0x20000000
      ram-size: 0x00008000
    - algorithm: ${CMSIS_PACK_ROOT}/Nuvoton/NuMicroM55_DFP/3.1.4-rc.3/Flash/M55M1_LD_8.FLM
      start: 0x0F100000
      size: 0x00002000
      ram-start: 0x20000000
      ram-size: 0x00008000
    - algorithm: ${CMSIS_PACK_ROOT}/Nuvoton/NuMicroM55_DFP/3.1.4-rc.3/Flash/M55M1_NS_2M.FLM
      start: 0x10100000
      size: 0x00200000
      ram-start: 0x20000000
      ram-size: 0x00008000
  debug-topology:
    debugports:
      - dpid: 0
        accessports:
          - apid: 0
            address: 0x00000000
    processors:
      - apid: 0
